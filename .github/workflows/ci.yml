name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.25"

      - name: Build
        run: go build ./...

      - name: Build CLI
        run: go build -o bin/scaf ./cmd/scaf

      - name: Build LSP
        run: go build -o bin/scaf-lsp ./cmd/scaf-lsp

      - name: Test
        run: go test ./...

      - name: Install tools
        run: |
          go install mvdan.cc/gofumpt@latest
          go install golang.org/x/tools/cmd/goimports@latest

      - name: Check formatting
        run: |
          gofumpt -d .
          test -z "$(gofumpt -l .)"

      - name: Check imports
        run: |
          goimports -d .
          test -z "$(goimports -l .)"

  build-examples:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.25"

      - name: Build examples
        working-directory: example
        run: go build ./...
